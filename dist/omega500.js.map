{"version":3,"sources":["node_modules/browser-pack/_prelude.js","Ω/Game.js","Ω/anim/Anim.js","Ω/anim/Anims.js","Ω/anim/index.js","Ω/assets/BitmapFont.js","Ω/assets/Image.js","Ω/assets/SpriteSheet.js","Ω/assets/index.js","Ω/cameras/Camera.js","Ω/cameras/TrackingCamera.js","Ω/cameras/index.js","Ω/entities/Entity.js","Ω/entities/index.js","Ω/gfx/gfx.js","Ω/gfx/index.js","Ω/index.js","Ω/input/index.js","Ω/input/input.js","Ω/maps/Map.js","Ω/maps/index.js","Ω/screens/Dialog.js","Ω/screens/Screen.js","Ω/screens/index.js","Ω/text/Text.js","Ω/text/index.js","Ω/utils/Stats.js","Ω/utils/Timer.js","Ω/utils/index.js","Ω/utils/math.js","Ω/utils/utils.js","Ω/Ω.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Screen","gfx","input","Stats","timer","utils","Game","w","h","_this","this","_classCallCheck","canvas","running","time","preset_dt","currentTime","Date","now","accumulator","screen","_screenPrev","_fade","ratio","dialog","fps","ctx","canvasSelector","arguments","undefined","selCanvas","document","querySelector","console","error","_readOnlyError","explicitWidth","nodeName","toUpperCase","getAttribute","explicitHeight","setAttribute","getContext","newCanvas","createElement","appendChild","imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","initCanvas","global","Ω","env","width","height","init","evt","onload","load","run","window","addEventListener","pageLoad","stats","_this2","frameTime","Math","min","tick","log","render","requestAnimationFrame","delta","start","loaded","_tick","timers","stop","_render","type","screenPrev","clear","color","globalAlpha","fillStyle","fillRect","pos","font","fillText","opts","_this3","screenPref","setDialog","Anim","name","sheet","speed","frames","cb","scale","changed","rewound","reset","diff","curFrame","x","y","Anims","anims","current","all","anim","push","func","forEach","animName","filter","get","set","SpriteSheet","BitmapFont","path","map","split","charCodeAt","msg","toString","cellW","ch","index","indexOf","Image","flipFlags","loadImage","img","self","drawImage","cellH","isNaN","_objectSpread","margin","padding","populate","flipImage","ceil","flags","j","createCanvas","save","translate","restore","col","row","Camera","zoom","debug","round","strokeStyle","strokeRect","renderables","prePost","renderPre","reduce","acc","Array","isArray","concat","repeat","renderPost","math","TrackingCamera","entity","bounds","_super","xRange","yRange","track","constrainToBounds","center","xr","yr","cam","debugOutline","_get","_getPrototypeOf","prototype","Entity","xo","yo","gravity","falling","wasFalling","remove","traits","bodies","mixin","body","tag","zIndex","trait","init_trait","apply","makeArgs","xBlocks","yBlocks","xv","hitX","hitY","yv","getBlocks","walkable","getBlockEdge","hitBlocks","images","resolve","image","cachedImage","_loaded","preload","procImage","src","scaleX","scaleY","alpha","oldAlpha","cn","text","drawShadowed","shadow","getWidth","measureText","getHalfWidth","getHeight","getHalfHeight","assets","entities","screens","Cameras","maps","modules","el","keys","mouse","touch","actions","KEYS","enter","space","escape","up","down","left","right","s","d","az_w","az_a","az_s","az_d","mouse1","mouse2","mouse3","wheelUp","wheelDown","touchMove","lastKey","lastKeyTime","dom","icade","keyHandler","setPos","relX","clientX","offsetLeft","relY","clientY","offsetTop","prev","mousewheel","max","wheelDelta","detail","keyed","epos","changedTouches","touches","urlParams","keyedIcade","keyCode","which","preventDefault","key","isDown","wasDown","bind","action","codes","_typeof","k","pressed","released","some","release","Map","cells","parallax","camera","cell","tw","th","stx","sty","endx","endy","block","blocks","getBlock","vertical","snapTo","snap","Dialog","killKey","done","game","clearDialog","frame","renderBG","renderFG","Text","updateSize","startTime","previous","fpsCur","fpsMin","fpsMax","ticks","Timer","add","dist","b","dx","dy","sqrt","distCenter","rotate","angle","point","origin","cos","sin","degToRad","deg","PI","radToDeg","rad","angleBetween","atan2","value","snapSize","floor","snapRound","clamp","val","finish","amount","lerp","lerpPerc","perc","smoothstep","ease","linear","end","inOutQuad","bounce","pp","ppp","rand","random","oneIn","rnd","seed","since","toggle","steps","offset","neighbours","radius","onlyOuterRing","abs","constrain","wrap","formatTime","mins","secs","formatScore","score","digits","pow","slice","loadScripts","scripts","script","qs","desktop","getTime","getByKeyValue","arrayOfObj","getAllByKeyValue","ajax","url","callback","xhr","XMLHttpRequest","readyState","open","send","fullscreen","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","cancel","request","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","preloading","pageLoaded","assetsToLoad","maxAssets","onloads","progress","location","search","match","params","pl","decode","decodeURIComponent","replace","query","substring","exec"],"mappings":"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","file":"omega500.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const Screen = require(\"./screens/Screen\");\r\nconst gfx = require(\"./gfx/gfx\");\r\nconst input = require(\"./input/input\");\r\nconst Stats = require(\"./utils/Stats\");\r\nconst timer = require(\"./utils/Timer\");\r\nconst utils = require(\"./utils/utils\");\r\n\r\nclass Game {\r\n\r\n  constructor(w, h) {\r\n\r\n    this.canvas = \"body\";\r\n\r\n    this.running = false;\r\n    this.time = 0;\r\n\r\n    this.preset_dt = 1 / 60;\r\n    this.currentTime = Date.now();\r\n    this.accumulator = 0;\r\n\r\n    this.screen = new Screen();\r\n    this._screenPrev = null;\r\n    this._fade = (() => ({ ratio: 0 })());\r\n    this.dialog = null;\r\n\r\n    this.fps = true;\r\n\r\n    const ctx = initCanvas(this.canvas, w, h);\r\n\r\n    global.Ω.env.w = ctx.canvas.width;\r\n    global.Ω.env.h = ctx.canvas.height;\r\n\r\n    gfx.init(ctx);\r\n    input.init(ctx.canvas);\r\n\r\n    global.Ω.evt.onload(() => {\r\n      this.load();\r\n      this.run(Date.now());\r\n    });\r\n\r\n    window.addEventListener(\"load\", function () {\r\n      global.Ω.pageLoad();\r\n    }, false);\r\n\r\n    this.running = true;\r\n\r\n    // Use the game time, rather than Date.now()\r\n    utils.now = () => this.now();\r\n\r\n    this.stats = Stats();\r\n\r\n  }\r\n\r\n  reset() {\r\n\r\n    this.time = 0;\r\n\r\n  }\r\n\r\n  now() {\r\n\r\n    return this.time * 1000;\r\n\r\n  }\r\n\r\n  load() { }\r\n\r\n  run() {\r\n\r\n\r\n    const now = Date.now();\r\n    const frameTime = Math.min((now - this.currentTime) / 1000, this.preset_dt);\r\n    let c;\r\n\r\n    this.currentTime = now;\r\n    this.accumulator += frameTime;\r\n\r\n    if (this.running) {\r\n      c = 0;\r\n      while (this.accumulator >= this.preset_dt) {\r\n        c++;\r\n        this.tick(this.preset_dt);\r\n        this.accumulator -= this.preset_dt;\r\n      }\r\n      if (c > 1) {\r\n        console.log(\"ran \" + c + \" ticks\");\r\n      }\r\n\r\n      this.render(gfx);\r\n    }\r\n\r\n    window.requestAnimationFrame(() => {\r\n\r\n      this.run(Date.now());\r\n\r\n    });\r\n\r\n  }\r\n\r\n  stop() { }\r\n\r\n  tick(delta) {\r\n\r\n    this.stats.start();\r\n\r\n    if (this.dialog) {\r\n      this.dialog.tick(delta);\r\n    } else {\r\n      this.time += delta;\r\n      if (this.screen.loaded) {\r\n        this.screen._tick();\r\n      }\r\n      global.Ω.timers.tick();\r\n    }\r\n    input.tick();\r\n\r\n    this.stats.stop();\r\n\r\n  }\r\n\r\n  render(gfx) {\r\n\r\n    const c = gfx.ctx;\r\n\r\n    if (!this.screen.loaded) {\r\n      return;\r\n    }\r\n\r\n    if (this._fade.ratio <= 0) {\r\n      this.screen._render(gfx);\r\n    } else {\r\n      switch (this._fade.type) {\r\n        case \"inout\":\r\n          // Fade in/out to a colour\r\n          if (this._fade.ratio > 0.5) {\r\n            this.screenPrev._render(gfx);\r\n            gfx.clear(this._fade.color, 1 - ((this._fade.ratio - 0.5) * 2));\r\n          } else {\r\n            this.screen._render(gfx);\r\n            gfx.clear(this._fade.color, this._fade.ratio * 2);\r\n          }\r\n          break;\r\n\r\n        case \"out\":\r\n          // Fade out to a colour\r\n          this.screenPrev._render(gfx);\r\n          gfx.clear(this._fade.color, 1 - this._fade.ratio);\r\n          break;\r\n\r\n        default:\r\n          // Crossfade\r\n          this.screen._render(gfx);\r\n          c.globalAlpha = this._fade.ratio;\r\n          this.screenPrev._render(gfx);\r\n          c.globalAlpha = 1;\r\n          break;\r\n      }\r\n\r\n    }\r\n    this.dialog && this.dialog.render(gfx);\r\n\r\n    if (this.fps) {\r\n      var fps = this.stats.fps();\r\n      gfx.ctx.fillStyle = \"rgba(0,0,0,0.3)\";\r\n      gfx.ctx.fillRect(this.stats.pos[0], this.stats.pos[1], 50, 20);\r\n\r\n      gfx.ctx.fillStyle = \"#fff\";\r\n      gfx.ctx.font = \"6pt monospace\";\r\n      gfx.ctx.fillText(fps[0] + \" \" + fps[1] + \"/\" + fps[2], this.stats.pos[0] + 5, this.stats.pos[1] + 13);\r\n    }\r\n\r\n  }\r\n\r\n  setScreen(screen, opts) {\r\n\r\n    opts = opts || {};\r\n\r\n    this.screenPrev = this.screen;\r\n    this.screen = screen;\r\n\r\n    if (this.screenPrev) {\r\n      this._fade = {\r\n        ratio: 1,\r\n        type: opts.type || \"inout\",\r\n        color: opts.color || \"#000\"\r\n      };\r\n      timer(opts.time || 20, (ratio) => {\r\n\r\n        this._fade.ratio = 1 - ratio;\r\n\r\n      }, () => {\r\n\r\n        this._fade.ratio = 0;\r\n        this.screenPref = null;\r\n\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  setDialog(dialog) {\r\n\r\n    this.dialog = dialog;\r\n\r\n  }\r\n  clearDialog() {\r\n\r\n    this.setDialog(null);\r\n\r\n  }\r\n};\r\n\r\n/*\r\n  Create or assign the canvas element\r\n*/\r\nfunction initCanvas(canvasSelector, w = 400, h = 225) {\r\n\r\n  const selCanvas = document.querySelector(canvasSelector);\r\n  let newCanvas;\r\n  let ctx;\r\n\r\n  if (selCanvas === null) {\r\n    console.error(\"Canvas DOM container not found:\", canvasSelector);\r\n    selCanvas = document.querySelector(\"body\");\r\n  }\r\n\r\n  if (selCanvas.nodeName.toUpperCase() === \"CANVAS\") {\r\n    const explicitWidth = selCanvas.getAttribute(\"width\");\r\n    const explicitHeight = selCanvas.getAttribute(\"height\");\r\n\r\n    if (explicitWidth === null) {\r\n      selCanvas.setAttribute(\"width\", w);\r\n    }\r\n    if (explicitHeight === null) {\r\n      selCanvas.setAttribute(\"height\", h);\r\n    }\r\n    ctx = selCanvas.getContext(\"2d\");\r\n  } else {\r\n    newCanvas = document.createElement(\"canvas\");\r\n    newCanvas.setAttribute(\"width\", w);\r\n    newCanvas.setAttribute(\"height\", h);\r\n    selCanvas.appendChild(newCanvas);\r\n    ctx = newCanvas.getContext(\"2d\");\r\n  }\r\n  ctx.imageSmoothingEnabled = false;\r\n  ctx.mozImageSmoothingEnabled = false;\r\n  ctx.webkitImageSmoothingEnabled = false;\r\n\r\n  if (!ctx) {\r\n    console.error(\"Could not get 2D context.\");\r\n  }\r\n\r\n  return ctx;\r\n}\r\n\r\nmodule.exports = Game;\r\n","const utils = require(\"../utils/utils\");\r\n\r\nclass Anim {\r\n  constructor(name, sheet, speed, frames, cb) {\r\n\r\n    this.name = name;\r\n    this.sheet = sheet;\r\n    this.frames = frames;\r\n    this.speed = speed;\r\n    this.cb = cb;\r\n\r\n    this.scale = 1;\r\n    this.changed = false;\r\n    this.rewound = false;\r\n\r\n    this.reset();\r\n\r\n  }\r\n\r\n  tick() {\r\n\r\n    const diff = utils.now() - this.frameTime;\r\n    this.changed = false;\r\n    this.rewound = false;\r\n\r\n    if (diff > this.speed) {\r\n      this.frameTime = utils.now() + (Math.min(this.speed, diff - this.speed));\r\n      if (++this.curFrame > this.frames.length - 1) {\r\n        this.curFrame = 0;\r\n        this.rewound = true;\r\n        this.cb && this.cb();\r\n      };\r\n      this.changed = true;\r\n    }\r\n\r\n  }\r\n\r\n  reset() {\r\n    this.curFrame = 0;\r\n    this.frameTime = utils.now();\r\n  }\r\n\r\n  render(gfx, x, y) {\r\n\r\n    this.sheet.render(\r\n      gfx,\r\n      this.frames[this.curFrame][0],\r\n      this.frames[this.curFrame][1],\r\n      x,\r\n      y,\r\n      1,\r\n      1,\r\n      this.scale);\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Anim;\r\n","\r\nclass Anims {\r\n\r\n\r\n  constructor(anims) {\r\n\r\n    this.current = null;\r\n    this.all = null;\r\n    if (anims.length) {\r\n      this.all = anims;\r\n      this.current = anims[0];\r\n    }\r\n\r\n  }\r\n\r\n  tick() {\r\n\r\n    this.current.tick();\r\n\r\n  }\r\n\r\n  add(anim) {\r\n\r\n    if (!this.all) {\r\n      this.all = [];\r\n      this.current = anim;\r\n    }\r\n    this.all.push(anim);\r\n\r\n  }\r\n\r\n  each(func) {\r\n\r\n    this.all.forEach(func);\r\n\r\n  }\r\n\r\n  get() {\r\n\r\n    return this.current.name;\r\n\r\n  }\r\n\r\n  set(animName) {\r\n\r\n    const anim = this.all.filter((anim) =>\r\n      anim.name === animName\r\n    );\r\n\r\n    if (anim.length) {\r\n      this.current = anim[0];\r\n      this.current.reset();\r\n    }\r\n\r\n  }\r\n\r\n  setTo(animName){\r\n    if (this.get() !== animName) {\r\n      this.set(animName);\r\n    }\r\n  }\r\n\r\n  changed() {\r\n\r\n    return this.current.changed;\r\n\r\n  }\r\n\r\n  rewound() {\r\n\r\n    return this.current.rewound;\r\n\r\n  }\r\n\r\n  render(gfx, x, y) {\r\n\r\n    this.current.render(gfx, x, y);\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Anims;\r\n","const Anim = require(\"./Anim\");\r\nconst Anims = require(\"./Anims\");\r\n\r\nmodule.exports = {\r\n  Anim,\r\n  Anims,\r\n}","const SpriteSheet = require(\"../assets/SpriteSheet\");\r\nclass BitmapFont {\r\n\r\n  constructor(path, w, h, map = \" !\\\"#$%&'()*+,-./0123456789:;<=>?@abcdefghijklmnopqrstuvwxyz[/]^_`abcdefghijklmnopqrstuvwxyz{|}~\") {\r\n\r\n    this.sheet = new SpriteSheet(path, w, h);\r\n\r\n    this.map = map.split(\"\").map((c) => c.charCodeAt(0));\r\n\r\n    this.w = w;\r\n    this.h = h;\r\n\r\n  }\r\n\r\n  render(gfx, msg, x, y) {\r\n\r\n    if (!msg) {\r\n      return;\r\n    }\r\n\r\n    msg = msg.toString();\r\n\r\n    const cellW = this.sheet.cellW;\r\n\r\n    for (let i = 0; i < msg.length; i++) {\r\n\r\n      const ch = msg.charCodeAt(i);\r\n      const index = this.map.indexOf(ch);\r\n\r\n      if (ch === 32 || index === -1) {\r\n        continue;\r\n      }\r\n\r\n      this.sheet.render(\r\n        gfx,\r\n        (index % cellW) | 0,\r\n        (index / cellW) | 0,\r\n        x + (i * this.w),\r\n        y);\r\n\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = BitmapFont;\r\n\r\n","  const gfx = require(\"../gfx/gfx\");\r\n  class Image {\r\n\r\n\t\tconstructor (path, flipFlags, scale) {\r\n      this.w= 0;\r\n      this.h= 0;\r\n\t\t\t\r\n\r\n\t\t\tthis.path = path;\r\n\r\n\t\t\tgfx.loadImage(path, function (img){\r\n\r\n\t\t\t\tself.img = img;\r\n\t\t\t\tself.w = img.width * self.scale;\r\n\t\t\t\tself.h = img.height * self.scale;\r\n\r\n\t\t\t}, flipFlags);\r\n\r\n\t\t\tthis.scale = scale || 1;\r\n\r\n\t\t}\r\n\r\n\t\trender (gfx, x, y) {\r\n\r\n\t\t\tgfx.ctx.drawImage(\r\n\t\t\t\tthis.img,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tthis.img.width * this.scale,\r\n\t\t\t\tthis.img.height * this.scale\r\n\t\t\t);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tmodule.exports = Image;","const gfx = require(\"../gfx/gfx\");\r\n\r\nclass SpriteSheet {\r\n\r\n  constructor(path, width, height, opts = {}) {\r\n\r\n    const defaults = {\r\n      flipFlags: null,\r\n      margin: [0, 0],\r\n      padding: [0, 0]\r\n    };\r\n\r\n\r\n    this.w = width;\r\n    this.h = height || width;\r\n    this.cellW = 0;\r\n    this.cellH = 0;\r\n\r\n    // Can pass flipFlags directly: TODO - figure out Options API\r\n    if (!isNaN(opts)) {\r\n      opts = {\r\n        flipFlags: opts\r\n      };\r\n    }\r\n    opts = { ...defaults, ...opts };\r\n\r\n    this.flipFlags = opts.flipFlags;\r\n    this.margin = opts.margin;\r\n    this.padding = opts.padding;\r\n\r\n    if (typeof path !== \"string\") {\r\n      // Direct init from image\r\n      this.populate(path, this.flipFlags);\r\n    } else {\r\n      gfx.loadImage(path, (img) => {\r\n\r\n        this.populate(img, self.flipFlags);\r\n\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  populate(img, flipFlags) {\r\n\r\n    this.sheet = img;\r\n    if (flipFlags >= 0) {\r\n      this.sheet = this.flipImage(img.canvas || img, flipFlags);\r\n    }\r\n\r\n    this.cellW = Math.ceil((img.width - this.margin[0]) / (this.w + this.padding[0]));\r\n    this.cellH = Math.ceil((img.height - this.margin[1]) / (this.h + this.padding[1]));\r\n\r\n  }\r\n\r\n  flipImage(img, flags) {\r\n\r\n    // flip: x = 1, y = 2, both = 3, none = 0\r\n\r\n    const ctx = Ω.gfx.createCanvas(\r\n      img.width * (flags & 1 ? 2 : 1),\r\n      img.height * (flags & 2 ? 2 : 1)\r\n    );\r\n    const cellW = img.width / this.w | 0;\r\n    const cellH = img.height / this.h | 0;\r\n    let i, j;\r\n\r\n    // Draw the original\r\n    ctx.drawImage(img, 0, 0);\r\n\r\n    if (flags & 1) {\r\n      // Flipped X\r\n      for (j = 0; j < cellH; j++) {\r\n        for (i = 0; i < cellW; i++) {\r\n          ctx.save();\r\n          ctx.translate(i * this.w * 0.5, j * this.h);\r\n          ctx.scale(-1, 1);\r\n          this.render({ ctx: ctx }, i, j, -(i * this.w * 0.5) - img.width - this.w, 0);\r\n          ctx.restore();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (flags & 2) {\r\n      // Flipped Y\r\n      for (j = 0; j < cellH; j++) {\r\n        for (i = 0; i < cellW; i++) {\r\n          ctx.save();\r\n          ctx.translate(i * this.w, j * this.h * 0.5);\r\n          ctx.scale(1, -1);\r\n          this.render({ ctx: ctx }, i, j, 0, -(j * this.h * 0.5) - img.height - this.h);\r\n          ctx.restore();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (flags & 3) {\r\n      // Flipped both\r\n      for (j = 0; j < cellH; j++) {\r\n        for (i = 0; i < cellW; i++) {\r\n          ctx.save();\r\n          ctx.translate(i * this.w * 0.5, j * this.h * 0.5);\r\n          ctx.scale(-1, -1);\r\n          this.render(\r\n            { ctx: ctx },\r\n            i,\r\n            j,\r\n            -(i * this.w * 0.5) - img.width - this.w,\r\n            -(j * this.h * 0.5) - img.height - this.h);\r\n          ctx.restore();\r\n        }\r\n      }\r\n    }\r\n\r\n    return ctx.canvas;\r\n\r\n  }\r\n\r\n  render(gfx, col, row, x, y, w = 1, h = 1, scale = 1) {\r\n    if (col === -1) {\r\n      return;\r\n    }\r\n\r\n    gfx.ctx.drawImage(\r\n      this.sheet,\r\n      col * (this.w + this.padding[0]) + this.margin[0],\r\n      row * (this.h + this.padding[1]) + this.margin[1],\r\n      w * this.w,\r\n      h * this.h,\r\n      x,\r\n      y,\r\n      w * this.w * scale,\r\n      h * this.h * scale);\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = SpriteSheet;\r\n","const Image = require(\"./Image\");\r\nconst SpriteSheet = require(\"./SpriteSheet\");\r\nconst BitmapFont = require(\"./BitmapFont\");\r\nmodule.exports = {\r\n  Image,\r\n  SpriteSheet,\r\n  BitmapFont,\r\n}","class Camera {\r\n  constructor(x = 0, y = 0, w = 0, h = 0) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.w = w;\r\n    this.h = h;\r\n\r\n    this.zoom = 1;\r\n    this.debug = false;\r\n  }\r\n\r\n  tick() { }\r\n\r\n  moveTo(x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  moveBy(x, y) {\r\n    this.x += x;\r\n    this.y += y;\r\n  }\r\n\r\n  renderPre(gfx) {\r\n    const c = gfx.ctx;\r\n\r\n    c.save();\r\n    c.scale(this.zoom, this.zoom);\r\n    c.translate(-(Math.round(this.x)), -(Math.round(this.y)));\r\n  }\r\n\r\n  renderPost(gfx) {\r\n    const c = gfx.ctx;\r\n\r\n    if (this.debug) {\r\n      c.strokeStyle = \"red\";\r\n      c.strokeRect(this.x, this.y, this.w / this.zoom, this.h / this.zoom);\r\n    }\r\n\r\n    c.restore();\r\n  }\r\n\r\n  render(gfx, renderables, prePost = true) {\r\n    prePost && this.renderPre(gfx);\r\n\r\n    renderables\r\n      // Flatten to an array\r\n      .reduce((acc, e) => {\r\n        if (Array.isArray(e)) {\r\n          return acc.concat(e);\r\n        }\r\n        acc.push(e);\r\n        return acc;\r\n      }, [])\r\n      // Remove out-of-view entities\r\n      // TODO: maybe use quad tree for this?\r\n      .filter((r) =>\r\n        r.repeat || !(\r\n          r.x + r.w < this.x ||\r\n          r.y + r.h < this.y ||\r\n          r.x > this.x + (this.w / this.zoom) ||\r\n          r.y > this.y + (this.h / this.zoom))\r\n      )\r\n      // Draw 'em\r\n      .forEach((r) => {\r\n        r.render(gfx, this);\r\n      });\r\n    prePost && this.renderPost(gfx);\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Camera;\r\n","const Camera = require(\"./Camera\");\r\nconst math = require('../utils/math');\r\n\r\nclass TrackingCamera extends Camera {\r\n  constructor(entity, w = 0, h = 0, bounds) {\r\n    super(0, 0, w, h);\r\n\r\n    this.xRange = entity.w;\r\n    this.yRange = entity.h;\r\n    this.zoom = 1;\r\n\r\n    this.bounds = bounds;\r\n\r\n    this.track(entity);\r\n  }\r\n\r\n  track(entity) {\r\n\r\n    this.entity = entity;\r\n    this.x = entity.x - (this.w / this.zoom / 2) + (entity.w / this.zoom / 2);\r\n    this.y = entity.y - (this.h / this.zoom / 2) + (entity.h / this.zoom / 2);\r\n\r\n    this.constrainToBounds();\r\n\r\n  }\r\n\r\n  constrainToBounds() {\r\n\r\n    if (this.x <= 0) {\r\n      this.x = 0;\r\n    } else {\r\n      if (this.bounds && this.x + this.w / this.zoom > this.bounds[0]) {\r\n        this.x = this.bounds[0] - this.w / this.zoom;\r\n      }\r\n    }\r\n    if (this.y <= 0) {\r\n      this.y = 0;\r\n    } else {\r\n      if (this.bounds && this.y + this.h / this.zoom > this.bounds[1]) {\r\n        this.y = this.bounds[1] - this.h / this.zoom;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  tick() {\r\n    const center = math.center(this, this.zoom);\r\n    const e = this.entity;\r\n    const xr = this.xRange;\r\n    const yr = this.yRange;\r\n\r\n    if (e.x < center.x - xr) {\r\n      this.x = e.x - (this.w / this.zoom / 2) + xr;\r\n    }\r\n    if (e.x + e.w > center.x + xr) {\r\n      this.x = e.x + e.w - (this.w / this.zoom / 2) - xr;\r\n    }\r\n    if (e.y < center.y - yr) {\r\n      this.y = e.y - (this.h / this.zoom / 2) + yr;\r\n    }\r\n    if (e.y + e.h > center.y + yr) {\r\n      this.y = e.y + e.h - (this.h / this.zoom / 2) - yr;\r\n    }\r\n\r\n    this.constrainToBounds();\r\n\r\n  }\r\n\r\n  debugOutline() {\r\n    return {\r\n      render: function (gfx, cam) {\r\n        const center = math.center(cam, cam.zoom);\r\n\r\n        gfx.ctx.strokeStyle = \"rgba(200, 255, 255, 1)\";\r\n        gfx.ctx.strokeRect(\r\n          center.x - cam.xRange,\r\n          center.y - cam.yRange,\r\n          cam.xRange * 2,\r\n          cam.yRange * 2);\r\n      }\r\n    }\r\n  }\r\n\r\n  render(gfx, renderables, prePost = true) {\r\n    if (this.debug) renderables = renderables.concat([this.debugOutline()]);\r\n\r\n    super.render(gfx, renderables, prePost);\r\n  }\r\n}\r\n\r\nmodule.exports = TrackingCamera;\r\n\r\n","const Camera = require(\"./Camera\");\r\nconst TrackingCamera = require(\"./TrackingCamera\");\r\nmodule.exports = {\r\n  Camera,\r\n  TrackingCamera,\r\n}","\r\nclass Entity {\r\n  constructor(x = 0, y = 0, w = 32, h = 32) {\r\n\r\n    this.xo = 0;\r\n    this.yo = 0;\r\n\r\n    this.gravity = 0;\r\n    this.falling = false;\r\n    this.wasFalling = false;\r\n\r\n    this.remove = false;\r\n\r\n    this.traits = null;\r\n\r\n    this.bodies = null; // bodies to be added by the screen\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.w = w;\r\n    this.h = h;\r\n\r\n    const t = this.traits || [];\r\n    this.traits = [];\r\n    this.mixin(t);\r\n\r\n  }\r\n\r\n  tick() {\r\n    this.traits = this.traits.filter((t) => t.tick.call(this, t));\r\n    return !(this.remove);\r\n  }\r\n\r\n  add(body, tag, zIndex) {\r\n    if (!this.bodies) {\r\n      this.bodies = [];\r\n    }\r\n    this.bodies.push([body, tag, zIndex]);\r\n    return body;\r\n  }\r\n\r\n  mixin(traits) {\r\n\r\n    traits.forEach(function (t) {\r\n\r\n      if (t.trait) {\r\n        const trait = new t.trait();\r\n        trait.init_trait.apply(this, [trait].concat(trait.makeArgs(t)));\r\n        this.traits.push(trait);\r\n      }\r\n\r\n    }, this);\r\n\r\n  }\r\n\r\n  hit(entity) { }\r\n\r\n  hitBlocks(xBlocks, yBlocks) { }\r\n\r\n  moveBy(xo, yo) {\r\n    this.xo = xo;\r\n    this.yo = yo;\r\n  }\r\n\r\n  /*\r\n    x & y is the amount the entity WANTS to move,\r\n    if there were no collision with the map.\r\n  */\r\n  move(x, y, map) {\r\n\r\n    // Temp holder for movement\r\n    let xo, yo;\r\n\r\n    let xv, yv;\r\n\r\n    let hitX = false;\r\n    let hitY = false;\r\n\r\n    let xBlocks;\r\n    let yBlocks;\r\n\r\n    // Apply simple gravity\r\n    if (this.falling) {\r\n      y += this.gravity;\r\n    }\r\n    xo = x;\r\n    yo = y;\r\n\r\n    xv = this.x + xo;\r\n    yv = this.y + yo;\r\n\r\n    // check blocks given vertical movement TL, BL, TR, BR\r\n    yBlocks = map.getBlocks([\r\n      [this.x, yv],\r\n      [this.x, yv + (this.h - 1)],\r\n      [this.x + (this.w - 1), yv],\r\n      [this.x + (this.w - 1), yv + (this.h - 1)]\r\n    ]);\r\n\r\n    // if overlapping edges, move back a little\r\n    if (y < 0 && (yBlocks[0] > map.walkable || yBlocks[2] > map.walkable)) {\r\n      // Hmmm... why only this guy needs to be floored?\r\n      yo = map.getBlockEdge((yv | 0) + map.sheet.h, \"VERT\") - this.y;\r\n      hitY = true;\r\n    }\r\n    if (y > 0 && (yBlocks[1] > map.walkable || yBlocks[3] > map.walkable)) {\r\n      yo = map.getBlockEdge(yv + this.h, \"VERT\") - this.y - this.h;\r\n      hitY = true;\r\n    }\r\n\r\n    // Add the allowed Y movement\r\n    this.y += yo;\r\n\r\n    // Now check blocks given horizontal movement TL, BL, TR, BR\r\n    xBlocks = map.getBlocks([\r\n      [xv, this.y],\r\n      [xv, this.y + (this.h - 1)],\r\n      [xv + (this.w - 1), this.y],\r\n      [xv + (this.w - 1), this.y + (this.h - 1)]\r\n    ]);\r\n\r\n    // if overlapping edges, move back a little\r\n    if (x < 0 && (xBlocks[0] > map.walkable || xBlocks[1] > map.walkable)) {\r\n      xo = map.getBlockEdge(xv + map.sheet.w) - this.x;\r\n      hitX = true;\r\n    }\r\n    if (x > 0 && (xBlocks[2] > map.walkable || xBlocks[3] > map.walkable)) {\r\n      xo = map.getBlockEdge(xv + this.w) - this.x - this.w;\r\n      hitX = true;\r\n    }\r\n\r\n    if (hitX || hitY) {\r\n      this.hitBlocks(hitX ? xBlocks : null, hitY ? yBlocks : null);\r\n    }\r\n\r\n    // Add the allowed X movement\r\n    this.x += xo;\r\n\r\n    // check if we're falling\r\n    yBlocks = map.getBlocks([\r\n      [this.x, this.y + this.h],\r\n      [this.x + (this.w - 1), this.y + this.h]\r\n    ]);\r\n\r\n    this.wasFalling = this.falling;\r\n    if (yBlocks[0] <= map.walkable && yBlocks[1] <= map.walkable) {\r\n      this.falling = true;\r\n    } else {\r\n      this.falling = false;\r\n    }\r\n\r\n    // Reset offset amount\r\n    this.xo = 0;\r\n    this.yo = 0;\r\n\r\n    return [xo, yo];\r\n  }\r\n\r\n  render(gfx) {\r\n\r\n    const c = gfx.ctx;\r\n\r\n    c.fillStyle = \"#c00\";\r\n    c.fillRect(this.x, this.y, this.w, this.h);\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Entity;\r\n","const Entity = require(\"./Entity\");\r\n\r\nmodule.exports = {\r\n  Entity,\r\n}","\tconst images = {};\r\n\r\n\tconst gfx = {\r\n\r\n\t\tinit: function (ctx) {\r\n\r\n\t\t\tthis.ctx = ctx;\r\n\t\t\tthis.canvas = ctx.canvas;\r\n\r\n\t\t\tthis.w = this.canvas.width;\r\n\t\t\tthis.h = this.canvas.height;\r\n\r\n\t\t},\r\n\r\n\t\tloadImage: function (path, cb, flipFlags) {\r\n\r\n\t\t\t// TODO: don't need to reload if non-flipped image exists\r\n\t\t\tconst cachedImage = images[path + (flipFlags ? \":\" + flipFlags : \"\")];\r\n\r\n\t\t\tif (cachedImage) {\r\n\t\t\t\tif (!cachedImage._loaded) {\r\n\t\t\t\t\tcachedImage.addEventListener(\"load\", function() {\r\n\t\t\t\t\t\tcb && cb(cachedImage);\r\n\t\t\t\t\t}, false);\r\n\t\t\t\t\tcachedImage.addEventListener(\"load\", function() {\r\n\t\t\t\t\t\tcb && cb(cachedImage);\r\n\t\t\t\t\t}, false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcb && cb(cachedImage);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst  resolve = global.Ω.preload(path);\r\n\t\t\t\tconst image = new Image();\r\n\t\t\t\tconst onload = ()=> {\r\n\r\n\t\t\t\t\tlet procImage;\r\n\r\n\t\t\t\t\tif (flipFlags >= 0) {\r\n\t\t\t\t\t\tprocImage = this.flipImage(image, flipFlags);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._loaded = true;\r\n\t\t\t\t\tcb && cb(procImage || image);\r\n\t\t\t\t\tresolve();\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\timage._loaded = false;\r\n\t\t\timage.src = path;\r\n\t\t\timage.addEventListener(\"load\", onload, false);\r\n\t\t\timage.addEventListener(\"error\", function() {\r\n\r\n\t\t\t\tconsole.error(\"Error loading image\", path);\r\n\t\t\t\tonload.call(this);\r\n\r\n\t\t\t}, false);\r\n\t\t\timages[path + (flipFlags ? \":\" + flipFlags : \"\")] = image;\r\n\r\n\t\t},\r\n\r\n\t\tdrawImage: function (img, x, y, scaleX, scaleY) {\r\n\r\n\t\t\tthis.ctx.drawImage(\r\n\t\t\t\timg,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\timg.width * scaleX ? scaleX : 1,\r\n\t\t\t\timg.height * scaleY ? scaleY : 1);\r\n\t\t},\r\n\r\n\t\tflipImage: function (img, flags) {\r\n\r\n\t\t\tconst ctx = this.createCanvas(img.width, img.height);\r\n\r\n\t\t\t// flip x = 1, y = 2, both = 3, none = 0\r\n\t\t\tctx.save();\r\n\t\t\tctx.translate(flags & 1 ? img.width : 0, flags & 2 ? img.height : 0);\r\n\t\t\tctx.scale(flags & 1 ? -1 : 1, flags & 2 ? -1 : 1);\r\n\t\t\tctx.drawImage(img, 0, 0);\r\n\t\t\tctx.restore();\r\n\r\n\t\t\treturn ctx.canvas;\r\n\r\n\t\t},\r\n\r\n\t\tclear: function (color, alpha) {\r\n\t\t\tconst c = this.ctx;\r\n\t\t\tlet\toldAlpha;\r\n\t\t\talpha = alpha === undefined ? 1 : alpha;\r\n\t\t\tif (alpha !== 1) {\r\n\t\t\t\toldAlpha = c.globalAlpha;\r\n\t\t\t\tc.globalAlpha = alpha;\r\n\t\t\t}\r\n\t\t\tc.fillStyle = color;\r\n\t\t\tc.fillRect(0, 0, this.w, this.h);\r\n\t\t\tif (oldAlpha) {\r\n\t\t\t\tc.globalAlpha = oldAlpha;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcreateCanvas: function (w, h) {\r\n\r\n\t\t\tconst cn = document.createElement(\"canvas\");\r\n\t\t\tconst\tctx = cn.getContext(\"2d\");\r\n\r\n\t\t\tcn.setAttribute(\"width\", w);\r\n\t\t\tcn.setAttribute(\"height\", h);\r\n\r\n\t\t\tctx.imageSmoothingEnabled = false;\r\n\t\t\tctx.mozImageSmoothingEnabled = false;\r\n\t\t\tctx.webkitImageSmoothingEnabled = false;\r\n\r\n\t\t\treturn ctx;\r\n\r\n\t\t},\r\n\r\n\t\ttext: {\r\n\r\n\t\t\tdrawShadowed: function (msg, x, y, shadow, font) {\r\n\r\n\t\t\t\tconst c = gfx.ctx;\r\n\r\n\t\t\t\tshadow = shadow || 2;\r\n\t\t\t\tif (font) {\r\n\t\t\t\t\tc.font = font;\r\n\t\t\t\t}\r\n\t\t\t\tc.fillStyle = \"#000\";\r\n\t\t\t\tc.fillText(msg, x + shadow, y + shadow);\r\n\t\t\t\tc.fillStyle = \"#fff\";\r\n\t\t\t\tc.fillText(msg, x, y);\r\n\r\n\t\t\t},\r\n\r\n\r\n\t\t\tgetWidth: function (msg) {\r\n\r\n\t\t\t\treturn gfx.ctx.measureText(msg).width;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tgetHalfWidth: function (msg) {\r\n\r\n\t\t\t\treturn this.getWidth(msg) / 2;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tgetHeight: function (msg) {\r\n\r\n\t\t\t\treturn gfx.ctx.measureText(msg).height;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tgetHalfHeight: function (msg) {\r\n\r\n\t\t\t\treturn this.getHeight(msg) / 2;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tmodule.exports = gfx;\r\n\r\n","const gfx = require(\"./gfx\");","const Ω = require(\"./Ω\");\r\n\r\nconst anim = require(\"./anim/index\");\r\nconst assets = require(\"./assets/index\");\r\nconst entities = require(\"./entities/index\");\r\nconst gfx = require(\"./gfx/index\");\r\nconst input = require(\"./input/index\");\r\nconst screens = require(\"./screens/index\");\r\nconst utils = require(\"./utils/index\");\r\nconst Game = require(\"./Game\");\r\nconst Cameras = require(\"./cameras/index\");\r\nconst text = require(\"./text/index\");\r\nconst maps = require(\"./maps/index\");\r\n\r\nconst modules = {\r\n    ...Ω,\r\n  ...anim,\r\n  ...assets,\r\n  ...entities,\r\n  ...gfx,\r\n  ...input,\r\n  ...screens,\r\n  ...utils,\r\n  ...Cameras,\r\n  ...text,\r\n  ...maps,\r\n  Game,\r\n}\r\nglobal.Ω = modules;\r\nmodule.exports = modules","const input = require(\"./input\");\r\n\r\nmodule.exports = {\r\n  input\r\n};","const keys = {};\r\nconst mouse = {\r\n  x: null,\r\n  y: null\r\n};\r\nconst touch = {\r\n  x: null,\r\n  y: null\r\n}\r\nconst actions = {};\r\n\r\nlet el;\r\n\r\nconst input = {\r\n  KEYS: {\r\n    enter: 13,\r\n    space: 32,\r\n    escape: 27,\r\n    up: 38,\r\n    down: 40,\r\n    left: 37,\r\n    right: 39,\r\n\r\n    w: 87,\r\n    a: 65,\r\n    s: 83,\r\n    d: 68,\r\n\r\n    az_w: 90,\r\n    az_a: 81,\r\n    az_s: 83,\r\n    az_d: 68,\r\n\r\n    mouse1: -1,\r\n    mouse2: -2,\r\n    mouse3: -3,\r\n    wheelUp: -4,\r\n    wheelDown: -5,\r\n\r\n    touch: -6,\r\n    touchMove: -7\r\n  },\r\n\r\n  mouse: mouse,\r\n  touch: touch,\r\n\r\n  lastKey: null,\r\n  lastKeyTime: Date.now(),\r\n\r\n  init: function (dom, icade) {\r\n\r\n    el = dom;\r\n\r\n    icade = icade || Ω.urlParams.icade;\r\n\r\n    bindKeys(!icade ? keyed : keyedIcade);\r\n    bindMouse();\r\n    bindTouch();\r\n\r\n  },\r\n\r\n  reset: function () {\r\n\r\n    var key;\r\n\r\n    for (key in keys) {\r\n      keys[key].isDown = false;\r\n      keys[key].wasDown = false;\r\n    }\r\n\r\n  },\r\n\r\n  tick: function () {\r\n\r\n    var key;\r\n\r\n    for (key in keys) {\r\n      keys[key].wasDown = keys[key].isDown;\r\n    }\r\n    if (keys[input.KEYS.wheelUp]) keyed(input.KEYS.wheelUp, false);\r\n    if (keys[input.KEYS.wheelDown]) keyed(input.KEYS.wheelDown, false);\r\n  },\r\n\r\n  bind: function (action, code) {\r\n\r\n    let codes;\r\n\r\n    if (typeof action === \"object\") {\r\n      codes = action;\r\n      for (action in codes) {\r\n        const key = codes[action];\r\n        if (Array.isArray(key)) {\r\n          key.forEach((k) => { this.bind(action, k) });\r\n        } else {\r\n          this.bind(action, key);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (typeof code !== \"number\") {\r\n      code = this.KEYS[code];\r\n      if (!code) {\r\n        console.error(\"Could not bind input: \", code);\r\n        return;\r\n      }\r\n    }\r\n\r\n    keys[code] = {\r\n      action: action,\r\n      isDown: false,\r\n      wasDown: false\r\n    };\r\n    if (!actions[action]) {\r\n      actions[action] = [];\r\n    }\r\n    actions[action].push(code);\r\n\r\n  },\r\n\r\n  pressed: function (action) {\r\n\r\n    return this.isDown(action) && !(this.wasDown(action));\r\n\r\n  },\r\n\r\n  released: function (action) {\r\n\r\n    return this.wasDown(action) && !(this.isDown(action));\r\n\r\n  },\r\n\r\n  isDown: function (action) {\r\n    var actionCodes = actions[action] || [];\r\n    return actionCodes.some((code) => {\r\n      return keys[code].isDown;\r\n    });\r\n  },\r\n\r\n  wasDown: function (action) {\r\n    var actionCodes = actions[action] || [];\r\n    return actionCodes.some((k) => {\r\n      return keys[k].wasDown;\r\n    });\r\n  },\r\n\r\n  release: function (action) {\r\n    var actionCodes = actions[action] || [];\r\n    actionCodes.forEach((code) => {\r\n      keyed(code, false);\r\n    });\r\n  }\r\n};\r\n\r\nfunction keyed(code, isDown) {\r\n\r\n  if (keys[code]) {\r\n    keys[code].wasDown = keys[code].isDown;\r\n    keys[code].isDown = isDown;\r\n  }\r\n\r\n  if (isDown) {\r\n    input.lastKey = code;\r\n    input.lastKeyTime = Date.now();\r\n  }\r\n\r\n}\r\n\r\nfunction keyedIcade(code, isDown) {\r\n\r\n  var icadeCodes = [87, 69, 88, 90, 68, 67, 65, 81, 89, 84],\r\n    KEYS = input.KEYS;\r\n\r\n  if (icadeCodes.indexOf(code) > -1) {\r\n\r\n    if (!isDown) {\r\n      // Don't handle key up with iCade!\r\n      return;\r\n    }\r\n\r\n    switch (code) {\r\n      case 87:\r\n        // Up\r\n        code = KEYS.up;\r\n        isDown = true;\r\n        break;\r\n      case 69:\r\n        code = KEYS.up;\r\n        isDown = false;\r\n        break;\r\n      // Down\r\n      case 88:\r\n        code = KEYS.down;\r\n        isDown = true;\r\n        break;\r\n      case 90:\r\n        code = KEYS.down;\r\n        isDown = false;\r\n        break;\r\n      // Right\r\n      case 68:\r\n        code = KEYS.right;\r\n        isDown = true;\r\n        break;\r\n      case 67:\r\n        code = KEYS.right;\r\n        isDown = false;\r\n        break;\r\n      // Left\r\n      case 65:\r\n        code = KEYS.left;\r\n        isDown = true;\r\n        break;\r\n      case 81:\r\n        code = KEYS.left;\r\n        isDown = false;\r\n        break;\r\n\r\n      // Fire\r\n      case 89:\r\n        code = KEYS.space;\r\n        isDown = true;\r\n        break;\r\n      case 84:\r\n        code = KEYS.space;\r\n        isDown = false;\r\n        break;\r\n    }\r\n  }\r\n\r\n  keyed(code, isDown);\r\n\r\n}\r\n\r\nfunction bindKeys(keyHandler) {\r\n\r\n  document.addEventListener('keydown', function (e) {\r\n    keyHandler(e.keyCode, true);\r\n  }, false);\r\n\r\n  document.addEventListener('keyup', function (e) {\r\n    keyHandler(e.keyCode, false);\r\n  }, false);\r\n\r\n}\r\n\r\nfunction bindMouse() {\r\n\r\n  function setPos(e) {\r\n\r\n    const relX = e.clientX - el.offsetLeft;\r\n    const relY = e.clientY - el.offsetTop;\r\n\r\n    mouse.diff = {\r\n      x: mouse.x - relX,\r\n      y: mouse.y - relY\r\n    };\r\n    mouse.prev = {\r\n      x: mouse.x,\r\n      y: mouse.y\r\n    };\r\n    mouse.x = relX;\r\n    mouse.y = relY;\r\n  }\r\n\r\n  document.addEventListener('mousedown', function (e) {\r\n\r\n    if (e.which === 1) {\r\n      setPos(e);\r\n      keyed(-1, true);\r\n    }\r\n\r\n  });\r\n\r\n  document.addEventListener('mousemove', function (e) {\r\n\r\n    setPos(e);\r\n\r\n  });\r\n\r\n  document.addEventListener('mouseup', function (e) {\r\n\r\n    if (e.which === 1) {\r\n      setPos(e);\r\n      keyed(-1, false);\r\n    }\r\n\r\n  });\r\n\r\n  function mousewheel(e) {\r\n\r\n    var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\r\n\r\n    if (delta === -1) keyed(input.KEYS.wheelUp, true);\r\n    if (delta === 1) keyed(input.KEYS.wheelDown, true);\r\n  }\r\n  document.addEventListener(\"mousewheel\", mousewheel, false);\r\n  document.addEventListener(\"DOMMouseScroll\", mousewheel, false);\r\n\r\n}\r\n\r\nfunction bindTouch() {\r\n\r\n  function setPos(e) {\r\n\r\n    let epos;\r\n\r\n    // TODO: handle multitouch\r\n    if (e.type === \"touchend\") {\r\n      epos = e.changedTouches ? e.changedTouches[0] : e;\r\n    } else {\r\n      epos = e.touches ? e.touches[0] : e;\r\n    }\r\n\r\n    const relX = epos.clientX - el.offsetLeft;\r\n    const relY = epos.clientY - el.offsetTop;\r\n\r\n    touch.diff = {\r\n      x: touch.x - relX,\r\n      y: touch.y - relY\r\n    };\r\n    touch.prev = {\r\n      x: touch.x,\r\n      y: touch.y\r\n    };\r\n    touch.x = relX;\r\n    touch.y = relY;\r\n  }\r\n\r\n  document.addEventListener('touchstart', function (e) {\r\n    setPos(e);\r\n    keyed(input.KEYS.touch, true);\r\n  }, false);\r\n  document.addEventListener('touchmove', function (e) {\r\n    e.preventDefault();\r\n    setPos(e);\r\n    keyed(input.KEYS.touchMove, true);\r\n  }, false);\r\n  document.addEventListener('touchend', function (e) {\r\n    setPos(e);\r\n    keyed(input.KEYS.touch, false);\r\n    keyed(input.KEYS.touchMove, false);\r\n  }, false);\r\n}\r\n\r\n\r\nmodule.exports = input;\r\n","const math = require(\"../utils/math\");\r\nclass Map {\r\n  constructor(sheet, cells = [[]], walkable = 0) {\r\n    this.x = 0; // Position required for camera rendering check\r\n    this.y = 0;\r\n\r\n    this.walkable = 0;\r\n\r\n    this.repeat = false;\r\n    this.parallax = 0;\r\n\r\n    this.sheet = sheet;\r\n    this.walkable = walkable;\r\n\r\n    this.populate(cells);\r\n  }\r\n\r\n  tick() {\r\n    return true;\r\n  }\r\n\r\n  populate(cells) {\r\n\r\n    this.cells = cells;\r\n    this.cellH = this.cells.length;\r\n    this.cellW = this.cells[0].length;\r\n    this.h = this.cellH * this.sheet.h;\r\n    this.w = this.cellW * this.sheet.w;\r\n\r\n  }\r\n\r\n  render(gfx, camera) {\r\n\r\n    if (!camera) {\r\n      camera = {\r\n        x: 0,\r\n        y: 0,\r\n        w: gfx.w,\r\n        h: gfx.h,\r\n        zoom: 1\r\n      };\r\n    }\r\n\r\n    const tw = this.sheet.w;\r\n    const th = this.sheet.h;\r\n    const cellW = this.sheet.cellW;\r\n    const cellH = this.sheet.cellH;\r\n    const stx = (camera.x - (camera.x * this.parallax)) / tw | 0;\r\n    const sty = (camera.y - (camera.y * this.parallax)) / th | 0;\r\n    const endx = stx + (camera.w / camera.zoom / tw | 0) + 1;\r\n    const endy = sty + (camera.h / camera.zoom / th | 0) + 1;\r\n\r\n    let j;\r\n    let i;\r\n    let cell;\r\n\r\n    if (this.parallax) {\r\n      gfx.ctx.save();\r\n      gfx.ctx.translate(camera.x * this.parallax | 0, camera.y * this.parallax | 0);\r\n    }\r\n\r\n    for (j = sty; j <= endy; j++) {\r\n      if (j < 0 || !this.repeat && j > this.cellH - 1) {\r\n        continue;\r\n      }\r\n      for (i = stx; i <= endx; i++) {\r\n        if (i < 0 || !this.repeat && i > this.cellW - 1) {\r\n          continue;\r\n        }\r\n\r\n        cell = this.cells[j % this.cellH][i % this.cellW];\r\n        if (cell === 0) {\r\n          continue;\r\n        }\r\n        this.sheet.render(\r\n          gfx,\r\n          (cell - 1) % cellW | 0,\r\n          (cell - 1) / cellW | 0,\r\n          i * tw,\r\n          j * th);\r\n      }\r\n    }\r\n\r\n    if (this.parallax) {\r\n      gfx.ctx.restore();\r\n    }\r\n\r\n  }\r\n\r\n  getBlockCell(block) {\r\n    let row = block[1] / this.sheet.h | 0;\r\n    let col = block[0] / this.sheet.w | 0;\r\n\r\n    if (row < 0 || row > this.cellH - 1) {\r\n      row = -1;\r\n    }\r\n    if (col < 0 || col > this.cellW - 1) {\r\n      col = -1;\r\n    }\r\n\r\n    return [col, row];\r\n  }\r\n\r\n  getCellPixels(block) {\r\n    const row = block[1] * this.sheet.h;\r\n    const col = block[0] * this.sheet.w;\r\n\r\n    return [col, row];\r\n  }\r\n\r\n  getBlock(block) {\r\n\r\n    const row = block[1] / this.sheet.h | 0;\r\n    const col = block[0] / this.sheet.w | 0;\r\n\r\n    if (row < 0 || row > this.cellH - 1) {\r\n      return;\r\n    }\r\n\r\n    return this.cells[row][col];\r\n\r\n  }\r\n\r\n  getBlocks(blocks) {\r\n    return blocks.map(this.getBlock, this);\r\n  }\r\n\r\n  getBlockEdge(pos, vertical) {\r\n\r\n    var snapTo = vertical ? this.sheet.h : this.sheet.w;\r\n\r\n    return math.snap(pos, snapTo);\r\n  }\r\n\r\n  setBlock(pos, block) {\r\n\r\n    var row = pos[1] / this.sheet.h | 0,\r\n      col = pos[0] / this.sheet.w | 0;\r\n\r\n    if (row < 0 || row > this.cellH - 1 || col < 0 || col > this.cellW - 1) {\r\n      return;\r\n    }\r\n\r\n    this.cells[row][col] = block;\r\n\r\n  }\r\n\r\n  setBlockCell(pos, block) {\r\n\r\n    var row = pos[1],\r\n      col = pos[0];\r\n\r\n    if (row < 0 || row > this.cellH - 1 || col < 0 || col > this.cellW - 1) {\r\n      return;\r\n    }\r\n\r\n    this.cells[row][col] = block;\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Map;\r\n\r\n","const Map = require(\"./Map\");\r\n\r\nmodule.exports = {\r\n  Map,\r\n}","const input = require(\"../input/input\");\r\n\r\nclass Dialog  {\r\n\r\n  constructor(key, cb) {\r\n\r\n    this.killKey = \"escape\";\r\n    this.time = 0;\r\n\r\n    if (typeof key === \"function\") {\r\n      cb = key;\r\n      key = null;\r\n    }\r\n\r\n    if (key) {\r\n      this.killKey = key;\r\n    }\r\n    this.cb = cb;\r\n\r\n  }\r\n\r\n  tick(delta) {\r\n\r\n    this.time += delta;\r\n\r\n    if (this.killKey && Ω.input.pressed(this.killKey)) {\r\n      input.release(this.killKey);\r\n      this.done();\r\n    }\r\n\r\n  }\r\n\r\n  done () {\r\n\r\n    window.game.clearDialog();\r\n    this.cb && this.cb();\r\n\r\n  }\r\n\r\n  render(gfx) {\r\n\r\n    const c = gfx.ctx;\r\n\r\n    c.fillStyle = \"rgba(0, 0, 0, 0.7)\";\r\n    c.fillRect(gfx.w * 0.15, gfx.h * 0.25, gfx.w * 0.7, gfx.h * 0.5);\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Dialog;\r\n","\r\nclass Screen {\r\n\r\n  constructor() {\r\n    this.loaded = true; // Set to false if you want to do async stuff\r\n    this.frame = 0;\r\n  }\r\n\r\n  tick() { }\r\n\r\n  _tick() {\r\n    this.frame++;\r\n    this.tick();\r\n  }\r\n\r\n  clear(gfx, col = \"hsl(195, 40%, 40%)\") {\r\n    gfx.clear(col);\r\n  }\r\n\r\n  render(gfx) {\r\n    const c = gfx.ctx;\r\n\r\n    c.fillStyle = \"hsl(0, 0%, 0%)\";\r\n    c.fillRect(0, 0, gfx.w, gfx.h);\r\n  }\r\n\r\n  _render(gfx) {\r\n    this.renderBG && this.renderBG(gfx);\r\n\r\n    // Render over entire view port\r\n    this.render(gfx);\r\n\r\n    this.renderFG && this.renderFG(gfx);\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Screen;\r\n\r\n","const Dialog = require(\"./Dialog\");\r\nconst Screen = require(\"./Screen\");\r\n\r\nmodule.exports = {\r\n  Dialog,\r\n  Screen,\r\n}","class Text {\r\n  constructor(font, text = \"\", x = 0, y = 0) {\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    this.font = font;\r\n    this.text = text;\r\n\r\n    this.updateSize();\r\n  }\r\n\r\n  setText(text) {\r\n    this.text = `${text}`;\r\n    this.updateSize();\r\n  }\r\n\r\n  setFont(font) {\r\n    this.font = font;\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    this.w = this.font.w * this.text.length;\r\n    this.h = this.font.h;\r\n  }\r\n\r\n  render(gfx) {\r\n    this.font.render(gfx, this.text, this.x, this.y)\r\n  }\r\n}\r\n\r\nmodule.exports = Text;","const Text = require(\"./Text\");\r\nmodule.exports = {\r\n  Text,\r\n}","const Stats = function () {\r\n\r\n  let startTime = Date.now();\r\n  let previous = startTime;\r\n  let fpsCur = 0;\r\n  let fpsMin = 100;\r\n  let fpsMax = 0;\r\n  let ticks = 0;\r\n\r\n  return {\r\n\r\n    pos: [Ω.env.w - 53, 3],\r\n\r\n    start: function () {\r\n\r\n      startTime = Date.now();\r\n\r\n    },\r\n\r\n    fps: function () {\r\n\r\n      return [fpsCur, fpsMin, fpsMax];\r\n\r\n    },\r\n\r\n    stop: function () {\r\n\r\n      var now = Date.now();\r\n\r\n      ticks++;\r\n\r\n      if (now > previous + 1000) {\r\n        fpsCur = Math.round((ticks * 1000) / (now - previous));\r\n        fpsMin = Math.min(fpsMin, fpsCur);\r\n        fpsMax = Math.max(fpsMax, fpsCur);\r\n\r\n        previous = now;\r\n        ticks = 0;\r\n      }\r\n\r\n    }\r\n  };\r\n};\r\n\r\nmodule.exports = Stats;\r\n","\r\nclass Timer {\r\n\r\n  constructor(time, cb, done) {\r\n\r\n    global.Ω.timers.add(this);\r\n\r\n    this.time = time;\r\n    if (!done) {\r\n      done = cb;\r\n      cb = null;\r\n    }\r\n    this.max = time;\r\n    this.cb = cb;\r\n    this.done = done;\r\n\r\n  }\r\n\r\n  tick() {\r\n\r\n    this.time -= 1;\r\n\r\n    if (this.time < 0) {\r\n      this.done && this.done();\r\n      return false;\r\n    }\r\n    this.cb && this.cb(1 - (this.time / this.max));\r\n\r\n    return true;\r\n  }\r\n\r\n}\r\n\r\nconst timer = function (time, cb, done) {\r\n  return new Timer(time, cb, done);\r\n};\r\n\r\nmodule.exports = timer;\r\n\r\n","const timer = require(\"./Timer\");\r\nconst Stats = require(\"./Stats\");\r\nconst utils = require(\"./utils\");\r\nconst math = require(\"./math\");\r\nmodule.exports = {\r\n  timer,\r\n  Stats,\r\n  utils,\r\n  math,\r\n}","const math = {\r\n\r\n  dist: (a, b) => {\r\n\r\n    const dx = a.x ? a.x - b.x : a[0] - b[0];\r\n    const dy = a.y ? a.y - b.y : a[1] - b[1];\r\n\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  },\r\n\r\n  distCenter: (a, b) => {\r\n\r\n    const dx = (a.x + (a.w / 2)) - (b.x + (b.w / 2));\r\n    const dy = (a.y + (a.h / 2)) - (b.y + (b.h / 2));\r\n\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  },\r\n\r\n  center: (e, zoom = 1) => ({\r\n    x: e.x + e.w / zoom / 2,\r\n    y: e.y + e.h / zoom / 2\r\n  }),\r\n\r\n\r\n  rotate: (angle, point, origin = [0, 0]) => {\r\n    const ox = Math.cos(angle) * (point[0] - origin[0]) - Math.sin(angle) * (point[1] - origin[1]) + origin[0];\r\n    const oy = Math.sin(angle) * (point[0] - origin[0]) + Math.cos(angle) * (point[1] - origin[1]) + origin[1];\r\n    return [ox, oy];\r\n  },\r\n\r\n  degToRad: (deg) => deg * Math.PI / 180,\r\n\r\n  radToDeg: (rad) => rad * 180 / Math.PI,\r\n\r\n  angleBetween: (a, b) => {\r\n\r\n    const dx = a.x - b.x;\r\n    const dy = a.y - b.y;\r\n    const angle = Math.atan2(dy, dx);\r\n\r\n    return angle;// % Math.PI;\r\n\r\n  },\r\n\r\n  snap: (value, snapSize) => Math.floor(value / snapSize) * snapSize,\r\n\r\n  snapRound: (value, snapSize) => {\r\n\r\n    const steps = value / snapSize | 0;\r\n\r\n    const remain = value - (steps * snapSize);\r\n    const rounder = remain > (snapSize / 2) ? Math.ceil : Math.floor;\r\n\r\n    return rounder(value / snapSize) * snapSize;\r\n  },\r\n\r\n  clamp: (val, min, max) => Math.max(min, Math.min(max, val)),\r\n\r\n  ratio: (start, finish, amount) => this.clamp((amount - start) / (finish - start), 0, 1),\r\n\r\n  lerp: (start, finish, amount) => amount * this.ratio(start, finish, amount),\r\n\r\n\r\n  // This is ease.linear\r\n  lerpPerc: (start, finish, perc) => ((finish - start) * perc) + start,\r\n\r\n  smoothstep: (start, finish, amount) => {\r\n\r\n    const x = this.ratio(start, finish, amount);\r\n\r\n    return amount * (x * x * x * (x * (x * 6 - 15) + 10)); //(x*x*(3 - 2*x));\r\n  },\r\n\r\n  ease: {\r\n\r\n    // TODO: add more Robert Penner goodness\r\n\r\n    linear: (start, end, perc) => (end - start) * perc + start,\r\n\r\n    inOutQuad: (start, end, perc) => start + ((end - start) / 2) * (perc < 0.5 ? 2 * perc * perc : -2 * perc * (perc - 2) - 1),\r\n\r\n    bounce: (start, end, perc) => {\r\n      const pp = perc * perc;\r\n      const ppp = pp * perc;\r\n      return start + (end - start) * (33 * ppp * pp + -106 * pp * pp + 126 * ppp + -67 * pp + 15 * perc);\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = math;\r\n","const utils = {\r\n\r\n\t\trand: function (max, min) {\r\n\r\n\t\t\tmax = max || 1;\r\n\t\t\tmin = min || 0;\r\n\r\n\t\t\treturn Math.floor(Math.random() * (max - min)) + min;\r\n\r\n\t\t},\r\n\r\n\t\toneIn: function (max) {\r\n\r\n\t\t\treturn this.rand(max) === 1;\r\n\r\n\t\t},\r\n\r\n\t\trnd: {\r\n\r\n\t\t\tseed: 42,\r\n\r\n\t\t\trand: function(max, min) {\r\n\r\n\t\t\t\tmax = max || 1;\r\n\t\t\t\tmin = min || 0;\r\n\r\n\t\t\t\tthis.seed = (this.seed * 9301 + 49297) % 233280;\r\n\r\n\t\t\t\treturn ((this.seed / 233280) * (max - min) + min) | 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// This gets overwritten by game.now\r\n\t\t// To use game time, not real-world time\r\n\t\tnow: function () {\r\n\r\n\t\t\treturn Date.now();\r\n\r\n\t\t},\r\n\r\n\t\tsince: function (time) {\r\n\r\n\t\t\treturn this.now() - time;\r\n\r\n\t\t},\r\n\r\n\t\ttoggle: function (time, steps, offset) {\r\n\r\n\t\t\treturn ((this.now() + (offset || 0)) / time) % steps >> 0;\r\n\r\n\t\t},\r\n\r\n\t\tneighbours: function (radius, cb, onlyOuterRing) {\r\n\r\n\t\t\tlet j, i;\r\n\r\n\t\t\tfor (j = -radius; j <= radius; j++) {\r\n\t\t\t\tfor(i = -radius; i <= radius; i++) {\r\n\t\t\t\t\tif(onlyOuterRing && (Math.abs(i) !== radius && Math.abs(j) !== radius)){\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcb && cb(i, j);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tconstrain: function (pos, bounds, wrap) {\r\n\r\n\t\t\tlet xo = pos[0];\r\n\t\t\tlet\tyo = pos[1];\r\n\t\t\tif (xo < 0) { xo = wrap ? bounds.w : 0; }\r\n\t\t\tif (yo < 0) { yo = wrap ? bounds.h : 0; }\r\n\t\t\tif (xo > bounds.w) { xo = wrap ? 0 : bounds.w; }\r\n\t\t\tif (yo > bounds.h) { yo = wrap ? 0 : bounds.h; }\r\n\r\n\t\t\treturn [xo, yo];\r\n\r\n\t\t},\r\n\r\n\t\tformatTime: function (t) {\r\n\r\n\t\t\tt /= 1000;\r\n\t\t\tlet mins = ~~(t / 60);\r\n\t\t\tlet\tsecs = ~~(t - (mins * 60));\r\n\r\n\t\t\tmins = mins.toString().length === 1 ? \"\" + mins : mins;\r\n\t\t\tsecs = secs.toString().length === 1 ? \"0\" + secs : secs;\r\n\t\t\treturn mins + \":\" + secs;\r\n\r\n\t\t},\r\n\r\n\t\tformatScore: function (score, digits) {\r\n\r\n\t\t\treturn ((score + Math.pow(10, digits)) + \"\").slice(1);\r\n\r\n\t\t},\r\n\r\n\t\tloadScripts: function (scripts, cb) {\r\n\r\n\t\t\tlet loaded = 0;\r\n\r\n\t\t\tscripts.forEach(function (path) {\r\n\r\n\t\t\t\tconst script = document.createElement('script');\r\n\t\t\t\tconst\tqs = window.env.desktop ? \"?\" + new Date().getTime() : \"\";\r\n\r\n\t\t\t\tscript.src = \"scripts/\" + path + \".js\" + qs;\r\n\t\t\t\tscript.onload = function () {\r\n\t\t\t\t\t// FIXME: where did this come from?: resources.toLoadLoaded++;\r\n\t\t\t\t\tif (loaded++ === scripts.length - 1) {\r\n\t\t\t\t\t\tcb && cb();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tdocument.body.appendChild(script);\r\n\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\t\tgetByKeyValue: function (arrayOfObj, key, value) {\r\n\r\n\t\t\treturn this.getAllByKeyValue(arrayOfObj, key, value)[0];\r\n\r\n\t\t},\r\n\r\n\t\tgetAllByKeyValue: function (arrayOfObj, key, value) {\r\n\r\n\t\t\treturn arrayOfObj.filter(function (o) {\r\n\t\t\t\tif (o[key] && o[key] === value) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\t\tajax: function (url, callback) {\r\n\r\n\t\t\tvar xhr = new XMLHttpRequest();\r\n\t\t\txhr.addEventListener(\"readystatechange\", function() {\r\n\t\t\t\tif (this.readyState < 4) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (xhr.readyState == 4) {\r\n\t\t\t\t\tcallback(xhr);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, false);\r\n\t\t\txhr.open(\"GET\", url, true);\r\n\t\t\txhr.send(\"\");\r\n\r\n\t\t},\r\n\r\n\t\tfullscreen: {\r\n\r\n\t\t\ttoggle: function (dom) {\r\n\r\n\t\t\t\tif (!document.fullscreenElement &&\r\n\t\t\t\t\t!document.mozFullScreenElement &&\r\n\t\t\t\t\t!document.webkitFullscreenElement) {\r\n\t\t\t\t\tthis.request(dom);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.cancel();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\trequest: function (dom) {\r\n\r\n\t\t\t\tif (typeof dom === \"string\") {\r\n\t\t\t\t\tdom = document.querySelector(dom);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (dom.requestFullscreen) {\r\n\t\t\t\t\tdom.requestFullscreen();\r\n\t\t\t\t} else if (dom.mozRequestFullScreen) {\r\n\t\t\t\t\tdom.mozRequestFullScreen();\r\n\t\t\t\t} else if (dom.webkitRequestFullscreen) {\r\n\t\t\t\t\tdom.webkitRequestFullscreen();\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tcancel: function () {\r\n\r\n\t\t\t\tif (document.cancelFullScreen) {\r\n\t\t\t\t\tdocument.cancelFullScreen();\r\n\t\t\t\t} else if (document.mozCancelFullScreen) {\r\n\t\t\t\t\tdocument.mozCancelFullScreen();\r\n\t\t\t\t} else if (document.webkitCancelFullScreen) {\r\n\t\t\t\t\tdocument.webkitCancelFullScreen();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t};\r\nmodule.exports = utils;","let preloading = true;\r\nlet pageLoaded = false;\r\nlet assetsToLoad = 0;\r\nlet maxAssets = 0;\r\nlet timers = [];\r\n\r\nconst Ω = {\r\n\r\n  evt: {\r\n    onloads: [],\r\n    progress: [],\r\n    onload: function (func) {\r\n      if (!pageLoaded) {\r\n        this.onloads.push(func);\r\n      } else {\r\n        // Page already loaded... so call it up.\r\n        func();\r\n      }\r\n    }\r\n  },\r\n\r\n  env: {\r\n    x: 0,\r\n    y: 0,\r\n    w: 0,\r\n    h: 0\r\n  },\r\n\r\n  preload: function (name) {\r\n\r\n    if (!preloading) {\r\n      return function () {\r\n        console.log(\"preloading finished!\", name);\r\n      };\r\n    }\r\n\r\n    maxAssets = Math.max(++assetsToLoad, maxAssets);\r\n\r\n    return () => {\r\n\r\n      assetsToLoad -= 1;\r\n\r\n      this.evt.progress.map((p) => p(assetsToLoad, maxAssets));\r\n\r\n      if (assetsToLoad === 0 && pageLoaded) {\r\n        if (!preloading) {\r\n          console.error(\"Preloading finished (onload called) multiple times!\");\r\n        }\r\n\r\n        preloading = false;\r\n        this.evt.onloads.map((o) => { o(); });\r\n      }\r\n    };\r\n  },\r\n\r\n  pageLoad: function () {\r\n\r\n    pageLoaded = true;\r\n\r\n    if (maxAssets === 0 || assetsToLoad === 0) {\r\n      // No assets to load, so fire onload\r\n      preloading = false;\r\n      this.evt.onloads.map((o) => { o(); });\r\n    }\r\n\r\n  },\r\n\r\n  timers: {\r\n\r\n    add: function (timer) {\r\n\r\n      timers.push(timer);\r\n\r\n    },\r\n\r\n    tick: function () {\r\n\r\n      timers = timers.filter((t) => t.tick());\r\n\r\n    }\r\n\r\n  },\r\n\r\n  urlParams: (function () {\r\n    if (!window.location && !window.location.search) {\r\n      return {};\r\n    }\r\n    const params = {};\r\n    let match;\r\n    const pl = /\\+/g;  // Regex for replacing addition symbol with a space\r\n    const search = /([^&=]+)=?([^&]*)/g;\r\n    const decode = (s) => decodeURIComponent(s.replace(pl, \" \"));\r\n    const query = window.location.search.substring(1);\r\n\r\n    while (match = search.exec(query)) {\r\n      params[decode(match[1])] = decode(match[2]);\r\n    }\r\n\r\n    return params;\r\n  }())\r\n\r\n};\r\n\r\nmodule.exports = Ω\r\n"]}